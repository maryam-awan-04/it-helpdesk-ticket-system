{% extends 'user/base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
    <div class="dashboard-summary">
        <div class="summary-box">
            <h2>Tickets Opened</h2>
            <div class="count">{% if open_tickets %}{{ open_tickets|length }}{% else %}0{% endif %}</div>
        </div>
        <div class="summary-box">
            <h2>Tickets In Progress</h2>
            <div class="count">{% if in_progress_tickets %}{{ in_progress_tickets|length }}{% else %}0{% endif %}</div>
        </div>
        <div class="summary-box">
            <h2>Tickets On Hold</h2>
            <div class="count">{% if on_hold_tickets %}{{ on_hold_tickets|length }}{% else %}0{% endif %}</div>
        </div>
        <div class="summary-box">
            <h2>Tickets Resolved</h2>
            <div class="count">{% if resolved_tickets %}{{ resolved_tickets|length }}{% else %}0{% endif %}</div>
        </div>
        <div class="summary-box">
            <h2>Tickets Closed</h2>
            <div class="count">{% if closed_tickets %}{{ closed_tickets|length }}{% else %}0{% endif %}</div>
        </div>
    </div>
    <div class="ticket-history-container">
        <div class="ticket-history-header">
            <h2>Ticket History</h2>
            <div class="filter-container">
                <label for="filterBy" class="filter-label">Filter By:</label>
                <select id="filterBy" class="filter-select">
                    <option value="">All</option>
                    <option value="date">Date</option>
                    <option value="request_type">Request Type</option>
                    <option value="status">Status</option>
                    <option value="title">Title</option>
                </select>
            </div>
        </div>
        <table class="ticket-table">
            <thead>
                <tr>
                    <th>Request ID</th>
                    <th>Date Opened</th>
                    <th>Request Type</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Assigned To</th>
                    <th>Status</th>
                    <th>Feedback Score</th>
                </tr>
            </thead>
            <tbody>
                {% if all_tickets %}
                    {% for ticket in all_tickets %}
                        <tr>
                            <td>{{ ticket.id }}</td>
                            <td>{{ ticket.date_opened }}</td>
                            <td>{{ ticket.request_type }}</td>
                            <td>{{ ticket.title }}</td>
                            <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis;">{{ ticket.description }}</td>
                            <td>{{ ticket.status }}</td>
                            <td>{{ ticket.assigned_to }}</td>
                            <td>{{ ticket.status }}</td>
                            <td>{{ ticket.feedback_score }}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr><td colspan="4">No ticket history available.</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>
{% endblock %}
